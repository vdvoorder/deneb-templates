{
    "data": {
      "values": [
        {"Category": "a", "Actual Value": 500, "Target Value": 450},
        {"Category": "b", "Actual Value": 295, "Target Value": 300},
        {"Category": "c", "Actual Value": 351, "Target Value": 350},
        {"Category": "d", "Actual Value": 205, "Target Value": 250}
      ]
    },
    "params": [{"name": "NearTargetBoundary", "value": 0.1}],
    "transform": [
      {
        "calculate": "if(datum['Actual Value'] - datum['Target Value'] >= 0, \"Over target\", if((abs(datum['Actual Value'] - datum['Target Value']) / datum['Target Value']) <= NearTargetBoundary, \"Near target\", \"Under target\"))",
        "as": "ActualState"
      },
      {"calculate": "\"Target\"", "as": "TargetDummy"},
      {
        "calculate": "datum['Actual Value'] + \"|\" + datum['ActualState']",
        "as": "ConcatenatedActual"
      },
      {
        "calculate": "datum['Target Value'] + \"|Target\"",
        "as": "ConcatenatedTarget"
      },
      {
        "fold": ["ConcatenatedActual", "ConcatenatedTarget"]
      }
    ],
    "layer": [
      {
        "description": "Target Value bars",
        "mark": {"type": "bar"},
        "encoding": {
          "x": {"field": "Target Value"},
          "fill": {"field": "TargetDummy"},
          "stroke": {"value": "gray"}
        }
      },
      {
        "description": "Actual Value bars",
        "mark": {"type": "bar", "opacity": 0.5},
        "encoding": {
          "x": {"field": "Actual Value"},
          "fill": {
            "field": "ActualState",
            "scale": {"range": ["gold", "dodgerblue", "lightgray", "crimson"]}
          }
        }
      }
    ],
    "encoding": {
      "x": {"type": "quantitative"},
      "y": {"field": "Category", "type": "nominal"}
    },
    "config": {}
  }